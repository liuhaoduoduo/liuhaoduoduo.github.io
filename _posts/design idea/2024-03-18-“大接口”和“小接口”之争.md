---
layout: post
title:  “大接口”和“小接口”之争
date:   2024-03-18 16:01:00 +0800
categories: design idea
---
### 前言
在设计接口时一个接口到底要包含多少逻辑，一直是一个值得讨论的问题。我对于这个问题也曾经跟我的同事们发生过无数次争执，也因此踩过坑。今天就聊聊这个问题。
### 大小接口的定义
大接口顾名思义就是一个接口中包含比较多的逻辑，什么叫比较多其实没有一个衡量标准。以下面的商品详情页举例子：
![商品详情页](https://github.com/liuhaoduoduo/liuhaoduoduo.github.io/raw/main/images/240318130859.jpg)
如果这个页面只使用一个“商品详情页接口”就能拉去页面中所需的全部数据，则可以认为这个接口是大接口，因为这个接口中需要包含图片、价格、促销信息、评价标签、已售数量和款式信息等等。

小接口的含义就是接口中的逻辑比较简单，比如说一个商品详情页在打开后需要调用价格接口、商品信息接口、促销信息接口、评价标签接口、已售数量接口等接口。这些接口其实就可以视为是小接口，因为他们只干了“一件事”（“商品详情页接口”在这里表示强烈不服，我也只干了“一件事”凭啥说我是大接口。这个问题后边在说。。。）
### 大接口的好处
大接口好处对于客户端来说比较明显，只需发送一次请求就可以。在发送请求时逻辑非常简单。解析逻辑其实也不算复杂，把所有解析逻辑都放在一起，相对于分散来说更内聚了。

对于服务端来说其实也不算太差，只做一个接口可以避免接口数爆炸（激增）的问题。同时业务代码如果都能独立封装好，调用一下就行。

### 大接口的坏处
大接口的主要坏处就是性能差，因为一个大接口中涉及了太多的业务，处理这么多业务逻辑和处理单个业务逻辑的耗时肯定不能比的。那么，肯定有人会说，可以通过多线程异步来解决啊。这其实有点天真了，把大接口的逻辑用多线程分别的并行执行确实可以提升一下性能节省一些时间，但是线程多了以后的线程切换也是耗时的啊。当然做小接口也会有线程切换问题，什么时候选择这个在后面的【结论】中会阐述。

### 小接口的好处
小接口性能上要比大接口要好一些（不绝对，但大概率是）。另外从设计模式来说小接口更满足“单一职责原则”，即小接口只做一件事。

### 小接口的坏处
小接口主要的坏处之一是数量太多，试想一下一个页面加载要调用几个甚至十几个接口时，维护这个页面的人是不是会很崩溃。就不看逻辑是否复杂，就数量上就够吓人的。这也是最初我选择大接口的一个原因。

再有一点，小接口的逻辑分散，几个接口要写几个接口请求状态的判断、兜底逻辑。在某些时候甚至这些都是样板代码。

最后是小接口对设备的性能要求比较高，并发请求多个接口，对设备的性能是有一定要求的。搞不好容易都卡死在那，一个都回不来。

### 结论
大小接口之间，我们应该如何选择呢？以我个人的经验来看，应该根据实际情况而定。这其实是一个无论怎么选择，都对且都不影响业务开发的问题。但是如果硬要说一个对错，硬要找一个方案选择点的话，我个人建议是根据实际情况。即做到接口数量上不爆炸，又做到接口性能数据上的好看。

我在之前的某次工作当中就犯了一次这样的错误，偏执的认为用大接口更好，这样即可做到把逻辑都收归到服务端，又可以避免一个页面同时请求多个接口的问题（这条主要是由于我之前是做客户端开发的，对一个页面需要请求多个接口比较反感）。但现实的结果打了我的脸，最主要的矛盾就出现在接口性能上。因为接口中的逻辑太多，导致接口的TPS只有一百左右。这在当时与其他接口的压测结果一对比是完全不能接受的，其他接口随便拿出一个都在七八百，你这一百的成绩怎么好意思拿的出手。这个时候领导就会给你一些压力，觉得你的技术水平不太行（因为领导才不会看你所谓的降低了接口数量和降低了并发请求提高了成功率的事，这些东西相比压测结果来说难以量化）。

### 关于单一职责原则问题
前面提到说小接口更满足单一职责原则，“商品详情页接口”表示不服的事。

其实他俩都满足“单一职责原则”，只不过是在评判他们是否满足时的视角问题。如果把“商品详情页”看作一个整体时，那“商品详情页接口”的职责确实就只有一个，人家没干其他乱七八糟的事对不对。但是这里有一个问题就是，“商品详情信息”其实是一个组合体，其中是由很多元素组成。所以如果把评判视角放在“最小可拆分”的维度上来说，那“商品详情页接口”确实不算是满足单一职责原则了。

这个也是我在开发过程中，经常引起我和同事们“亲切友好的交谈”的点。我们都会坚持自己对“单一职责原则”的理解，有时更是不愿意轻易放下自己的观点。现在想想这真的是一件无关紧要的小事，之前的“亲切友好的交谈”真的是太没必要了。

### 最后
在最后，我希望看这边文章的朋友能够和我一样，在今后的工作中对于大小接口的选择上能做出符合自己预期和领导预期（重点考虑）的抉择。能够在接口数量和性能上取得一个平衡。这样既完成了工作，又不失在领导那的好印象。若还拿商品详情页举例，其实可以拆分成多个聚合接口，比如说“商品基本信息”接口和“商品扩展信息”接口。在“商品基本信息接口”信息中，仅包括商品名、价格、图片链接。在“商品扩展信息”中包括评价标签、促销信息、销售情况等数据。这样即没有在数量上触及接口爆炸（才2个，和5到6个比比是不是好太多了），又能在性能上取得优异成绩（每个接口100到150毫秒，qps又能和其他接口持平或相近）。这是不是一个很完美的方案。毕竟领导才懒得听你解释大小接口的优劣势，人家只看可以量化的数据。