---
layout: post
title:  并发编程三大问题
date:   2025-03-20 10:30:00 +0800
categories: other
---
* 原子性：所有的操作都需要一次性完成，中间不能被其他线程打断和干扰。最常见的就是计算和赋值这两步，如果不加控制容易被打断；还有在 32 位平台对 64 位数赋值的操作，可能被拆分为低 32 位和高 32 位赋值两部步骤。

* 可见性：每个 cpu 核心是有自己的独享缓存的，共享变量被多个核心加载的时候回出现多个副本在各个核心的各自缓存中。若其中一个核心对该共享变量做了修改，其他核心的缓存通常来说是不可见的。并发编程必须通过一定方式解决这个问题。Intel 的 MESI 协议是在一个核心要写数据时如果发现该数据是多核心共享的则将其他核心的缓存内容标识为无效。这样其他核心在打算写数据时将从内存中强制重新读取数据。

* 顺序性：指令重排问题。两个方法访问共享变量。但两个方法单独看不存在任何违反指令重排规范的地方，但将视角提升后就会发现存在违反指令重排的问题。编译器和处理器是无法发现这类问题，需要认为的使用 volatile 关键字来阻止指令重排。关于指令重排的解释详见：[什么是指令重排？为什么双重检查模式锁定模式要禁止指令重排？](https://liuhaoduoduo.github.io/other/2025/03/19/%E4%BB%80%E4%B9%88%E6%98%AF%E6%8C%87%E4%BB%A4%E9%87%8D%E6%8E%92-%E4%B8%BA%E4%BB%80%E4%B9%88%E5%8F%8C%E9%87%8D%E6%A3%80%E6%9F%A5%E9%94%81%E5%AE%9A%E6%A8%A1%E5%BC%8F%E8%A6%81%E7%A6%81%E6%AD%A2%E6%8C%87%E4%BB%A4%E9%87%8D%E6%8E%92.html)