---
layout: post
title:  模拟遗漏导致的PotentialStubbingProblem异常
date:   2024-04-17 19:50:00 +0800
categories: unit test
---
### 故障现象
今天在写单元测试过程中遇到了如下图的错误提示
![单测报错](https://github.com/liuhaoduoduo/liuhaoduoduo.github.io/raw/main/images/240417195000.png)
从提示上可以看出大概的问题原因是单测中配置的方法模拟参与实际调用业务代码中调用的参数是不符导致的。但问题是这个测试用例中配置的模拟并没有错，要测试的代码也不是提示中所提示的38行位置。
### 排查过程
首先怀疑是不是由于同一个单测类中其他的单测方法的模拟干扰导致的。为此在代码中尝试增加了如下的代码，在每次执行单测方法前都重置一下模拟配置。
![模拟重置](https://github.com/liuhaoduoduo/liuhaoduoduo.github.io/raw/main/images/240417195500.png)

但很遗憾，问题并未得到解决。
截下来只能仔细分析单测代码和业务代码了。分析后发现，在业务逻辑代码中同样的方法调用了多次，只是参数不同。这里大胆的推测了一下是不是需要将所有的调用都进行模拟才可以呢。紧接着做了一下尝试，在单测代码中，把刚才错误提示中的调用参数也进行了模拟后，问题得到解决。
### 经验总结
在后续单测编写过程中，要特别注意对“模拟”的配置。即便是该测试方法不关注的逻辑代码，如果有相同方法的调用也要配置好模拟。不能只关注被测试的部分。

